# Caddy Configuration for Open HIMS
# Development Configuration

# Development Web App
dev.openhims.health {
	# Use self-signed certificate for local development
	tls internal

	# Proxy to Vite dev server
	reverse_proxy localhost:5173 {
		header_up Host {upstream_hostport}
		header_up X-Real-IP {remote_host}

		# WebSocket support for Vite HMR
		header_up Connection {>Connection}
		header_up Upgrade {>Upgrade}
	}

	# API proxy to development backend
	reverse_proxy /api/* {
		to localhost:8080
		header_up Host {upstream_hostport}
		header_up X-Real-IP {remote_host}
	}

	# CORS headers for development
	header Access-Control-Allow-Origin "*"
	header Access-Control-Allow-Methods "*"
	header Access-Control-Allow-Headers "*"

	# Development logging (local directory)
	log {
		output file ./logs/dev.openhims.health.log {
			roll_size 5mb
			roll_keep 5
		}
		format console
	}
}

# Development API (separate domain)
api-dev.openhims.health {
	# Use self-signed certificate for local development
	tls internal

	# Rust backend API
	reverse_proxy localhost:8080 {
		header_up Host {upstream_hostport}
		header_up X-Real-IP {remote_host}
	}

	# CORS headers for development
	header Access-Control-Allow-Origin "*"
	header Access-Control-Allow-Methods "*"
	header Access-Control-Allow-Headers "*"

	log {
		output file ./logs/api-dev.openhims.health.log {
			roll_size 5mb
			roll_keep 5
		}
		format console
	}
}
